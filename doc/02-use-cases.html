<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>My personal website</title>

        <link rel="stylesheet" href="https://lianhub.github.io/try1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://lianhub.github.io/try1/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://lianhub.github.io/try1/css/highlight.dark.css">
        <link rel="stylesheet" href="https://lianhub.github.io/try1/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="https://lianhub.github.io/try1/">
                My personal website
                <small class="hidden-xs hidden-sm">
                    documentations for myself!
                </small>
            </a>

                            <a href="https://github.com/lianhub/try1">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                        <ul class="nav nav-pills nav-stacked">
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/">
                                        Home
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/01-tutorial.html">
                                        Couscous Notes
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/02-use-cases.html">
                                        EtherCAT Master
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/03-reference.html">
                                        PCB
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/04-vocabulary.html">
                                        Kinetis
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/05-extending.html">
                                        XMOS
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/06-exceptions.html">
                                        Misc
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/07-twincat.html">
                                        TwinCAT
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/08-folders.html">
                                        Folders
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://lianhub.github.io/try1/doc/09-uboot.html">
                                        U-Boot
                                    </a>
                                </li>
                                                    </ul>

                    </nav>

                
                <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1 id="igh-ethercat-master">IgH EtherCAT Master</h1>
<p>This page instructs how to set up IgH EtherCAT master on raspberry PI-3.</p>
<p>Please follow the steps below:</p>
<ul>
<li><a href="#setup-rt-preempt">Setup RT-Preempt</a>
<ul>
<li><a href="#download">Download</a></li>
<li><a href="#patch">Patch</a></li>
<li><a href="#prevent-freezing">Prevent freezing</a></li>
</ul></li>
<li><a href="#build-ethercat">Build EtherCAT</a>
<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#copy">Copy</a></li>
</ul></li>
<li><a href="#install-machinekit">Install Machinekit</a></li>
<li><a href="#install-linuxcnc-ethercat">Install Linuxcnc-Ethercat</a></li>
<li><a href="#beaglebone-issue">Beaglebone Issue</a></li>
<li><a href="#yocto-sdk-issue">Yocto-SDK Issue</a></li>
<li><a href="#previous-readings">Previous readings</a></li>
</ul>
<h2 id="setup-rt-preempt">Setup RT-Preempt</h2>
<p>Many projects use the YAML format in their configuration files.</p>
<h3 id="download">Download</h3>
<ul>
<li>Release date: 2017-08-16</li>
<li>Kernel version: 4.9</li>
<li>uname-a: Linux raspberrypi 4.9.41-v7+ #1023 SMP Tue Aug 8 16:00:15 BST 2017 armv7l GNU/Linux</li>
<li>uname-a: Linux raspberrypi 4.9.43-rt30-v7+ #1 SMP PREEMPT RT Thu Aug 17 12:23:30 EDT 2017 armv7l GNU/Linux</li>
</ul>
<h3 id="patch">Patch</h3>
<p>Follow these instructions in file &quot;Machinekit-RT-Preempt-RPI.md&quot; at: <a href="https://github.com/koppi/mk">Get a basic Machinekit / EtherCAT system on the Raspberry PI 3 Model B</a></p>
<ul>
<li>Patch: patch-4.9.40-rt30.patch.gz</li>
</ul>
<blockquote>
<p><strong>Note</strong>: see <code>BundleRoutingTest</code> for an actual implementation.</p>
</blockquote>
<h3 id="prevent-freezing">Prevent freezing</h3>
<p>Follow these instructions modify /boot/cmdline.txt: <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=29&amp;t=159170">Freezing with RT-patch (Pi 3)</a></p>
<ul>
<li>Add this: <code>dwc_otg.fiq_fsm_enable=0 dwc_otg.fiq_enable=0 dwc_otg.nak_holdoff=0</code></li>
</ul>
<p>It appears that what did the trick has been the order of the fiq disable commands. dwc_otg.fiq_fsm_enable=0 must be set <em>before</em> dwc_otg.fiq_enable=0. The other way around it finds fiq_fsm_enable true with fiq_enable false, and it forces fiq_enable true.</p>
<h2 id="build-ethercat">Build EtherCAT</h2>
<ul>
<li>sudo apt install autoconf libtool</li>
<li>./configure --enable-generic --disable-8139too</li>
</ul>
<blockquote>
<p><strong>Note</strong>: be sure that you keep the /opt/linux folder: --with-linux-dir.</p>
</blockquote>
<h3 id="configuration">Configuration</h3>
<p>Copy folder to: etc/sysconfig/, and edit file <code>ethercat</code>:</p>
<ul>
<li>sudo cp -r /opt/etherlab/etc/sysconfig /etc/</li>
<li>MAC address,</li>
<li>&quot;generic&quot;,</li>
<li>modprobe/depmod?</li>
</ul>
<h2 id="install-machinekit">Install Machinekit</h2>
<p>Install packages: machinekit, machinekit-dev, machinekit-rt-preempt!</p>
<ul>
<li>sudo dpkg -i *.deb</li>
<li>sudo apt install gdebi</li>
<li>sudo apt --fix-broken install</li>
<li>dpkg-repack</li>
</ul>
<h2 id="install-linuxcnc-ethercat">Install Linuxcnc-Ethercat</h2>
<p>Copy to appropriate folders: lcec.so, lcec_conf, libethercat.so</p>
<ul>
<li>make</li>
<li>sudo make install</li>
<li>/usr/bin/lcec_conf</li>
<li>sudo cp /usr/lib/linuxcnc/posix/lcec.so /usr/lib/linuxcnc/rt-preempt/lcec.so</li>
<li>sudo cp /opt/etherlab/include/ecrt.h /usr/include/linuxcnc/</li>
<li>sudo cp /opt/etherlab/lib/libethercat.so.1 /usr/lib/linuxcnc/rt-preempt/</li>
<li>sudo cp /opt/etherlab/lib/libethercat.so /usr/lib/linuxcnc/rt-preempt/</li>
</ul>
<h2 id="beaglebone-issue">Beaglebone Issue</h2>
<p>As stated in video <a href="https://www.youtube.com/watch?v=M1LxQBjttWg">Machinekit + EtherCAT on BeagleBone Black </a>:</p>
<blockquote>
<p><strong>Note</strong>: The external NIC is used due to the need of preservation of the on board NIC
for LAN operation and the fact that the SoC has an integrated switch, wich affected real
time capability.</p>
</blockquote>
<p>An interesting article is <a href="https://www.embeddedrelated.com/showarticle/586.php">Using the Beaglebone PRU to achieve realtime at low cost</a></p>
<h2 id="yocto-sdk-issue">Yocto-SDK Issue</h2>
<p><em><a href="https://github.com/Achillefs/geoip/issues/3">libtoolize -f before ./configure</a>
</em><a href="https://github.com/joakim666/colortail/issues/14">./configure --disable-dependency-tracking</a></p>
<h2 id="previous-readings">Previous readings</h2>
<ul>
<li><a href="../index.html">README</a></li>
<li><a href="01-tutorial.html">Tutorial</a></li>
</ul>
                </section>

            </div>
        </main>

        <footer>
            <div class="container-fluid">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
